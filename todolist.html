<html>
  <head>
    <link rel="stylesheet" href="css/todolist.css" />
    <script src="js/main.js"></script>
    <script>
      function editdeleteupdate(contactdetails) {
        let html = "";
        let addtasklist = document.getElementById("addtasklist");
        html += " <tbody id='addtasklist'>";
        let i;
        for (i = 0; i < contactdetails.length; i++) {
          html += `<tr>
            <td> ${contactdetails[i].fname} ${contactdetails[i].lname}</td>
            <td> ${contactdetails[i].countrycode}</td>
            <td> ${contactdetails[i].mobilenumber}</td>
            <td>
            <button id="edittask" onclick="editupdate(${contactdetails[i].id})"><img src='./icons/edit.png' /></button>
            <button id='deletetask' onclick='deleteupdatetask(${contactdetails[i].id})'><img class='delete' src='./icons/delete.png' /></button>
            </td>
            </tr>
            `;
        }
        html += "</tbody>";
        addtasklist.innerHTML = html;
      }
    </script>
  </head>
  <body>
    <div class="data-div" id="opendatatable">
      <div class="div-style">
        <table class="table-div">
          <caption class="caption-style">
            Contact details
          </caption>
          <thead>
            <tr>
              <th>Name</th>
              <th>Country code</th>
              <th>Mobile number</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody id="addtasklist">
            <script>
              let contactinfo = localStorage.getItem("localtask");
              if (contactinfo == null) {
                contactdetails = [];
              } else {
                contactdetails = JSON.parse(contactinfo);
              }
              let i;
              editdeleteupdate(contactdetails);
            </script>
          </tbody>
        </table>
        <div class="button-div">
          <button
            onclick="document.getElementById('modal').style.display='block'"
            class="buttonFirst"
          >
            Add contacts
          </button>
        </div>
      </div>
    </div>
    <div class="main-div" id="modal">
      <div class="removeicon">
        <img src="./icons/remove.png" onclick="removemodal()" />
      </div>
      <script>
        function removemodal() {
          document.getElementById("modal").style.display = "none";
          document.getElementById("opendatatable").style.display = "block";
          document.getElementById("opendatatable").style.opacity = "1";
        }
      </script>
      <div class="div">
        <h1 class="header">Enter details</h1>
        <div class="input-main-div">
          <div>
            <label class="label">First Name</label>
            <input
              class="input-div"
              placeholder="Enter your first name"
              id="enterfname"
            />
          </div>
          <div>
            <label class="label">Last Name</label>
            <input
              class="input-div"
              placeholder="Enter yout last name"
              id="enterlname"
            />
          </div>
          <label class="label">Mobile number</label>
          <div class="input-one-row">
            <input
              type="number"
              class="input-row"
              required
              placeholder="+"
              id="entercountrycode"
            />
            <input
              type="number"
              required
              class="input-number"
              placeholder="Enter mobile number"
              id="enternumber"
            />
          </div>
        </div>
        <button class="button" id="clicksubmit">Submit</button>
        <button class="button" id="savetask" style="display: none">Save</button>
      </div>
    </div>
    <script>
      document.getElementById("clicksubmit").onclick = function () {
        document.getElementById("opendatatable").style.display = "block";
        document.getElementById("modal").style.display = "none";
        let datakeys = {
          fname: "",
          lname: "",
          countrycode: "",
          mobilenumber: "",
          id: "",
        };
        let enterfname = document.getElementById("enterfname").value;
        let enterlname = document.getElementById("enterlname").value;
        let entercountrycode = document.getElementById("entercountrycode").value;
        let enternumber = document.getElementById("enternumber").value;
        datakeys.fname = enterfname;
        datakeys.lname = enterlname;
        datakeys.countrycode = entercountrycode;
        datakeys.mobilenumber = enternumber;
        if (enterfname == "") {
          document.getElementById("modal").style.display = "block";
          alert("Please enter your first name");
        } else if (enterlname == "") {
          document.getElementById("modal").style.display = "block";
          alert("Please enter your last name");
        } else if (entercountrycode == "") {
          document.getElementById("modal").style.display = "block";
          alert("Please enter country code");
        } else if (enternumber == "") {
          document.getElementById("modal").style.display = "block";
          alert("Please enter mobile number ");
        } else {
          alert("Your form is submitted");
          let contactdetails = [];
          let contactinfo = localStorage.getItem("localtask");
          if (!contactinfo) {
            contactdetails = [];
          } else {
            contactdetails = JSON.parse(contactinfo);
            datakeys.id = Math.random();
          }
          contactdetails.push(datakeys);
          localStorage.setItem("localtask", JSON.stringify(contactdetails));

          document.getElementById("enterfname").value = "";
          document.getElementById("enterlname").value = "";
          document.getElementById("entercountrycode").value = "";
          document.getElementById("enternumber").value = "";

          showtask();
        }
      };
      function showtask() {
        let contactinfo = localStorage.getItem("localtask");
        if (contactinfo == null) {
          contactdetails = [];
        } else {
          contactdetails = JSON.parse(contactinfo);
        }
        editdeleteupdate(contactdetails);
      }
      function editupdate(edittask) {
        alert("You can edit the details");
        document.getElementById("modal").style.display = "block";
        document.getElementById("opendatatable").style.opacity = "0.5";
        let clicksubmit = (document.getElementById("clicksubmit").style.display =
          "none");
        let savetask = (document.getElementById("savetask").style.display =
          "block");

        const changevalue = contactdetails.find((data) => data.id == edittask);
        let enterfname = (document.getElementById("enterfname").value =
          changevalue.fname);
        let enterlname = (document.getElementById("enterlname").value =
          changevalue.lname);
        let entercountrycode = (document.getElementById("entercountrycode").value =
          changevalue.countrycode);
        let enternumber = (document.getElementById("enternumber").value =
          changevalue.mobilenumber);
        localStorage.setItem("editid", edittask);
        document.getElementById("savetask").onclick = function () {
          document.getElementById("opendatatable").style.display = "block";
          document.getElementById("modal").style.display = "none";
          let datakeys = {
            fname: "",
            lname: "",
            countrycode: "",
            mobilenumber: "",
            id: "",
          };

          let enterfname = document.getElementById("enterfname").value;
          let enterlname = document.getElementById("enterlname").value;
          let entercountrycode = document.getElementById("entercountrycode").value;
          let enternumber = document.getElementById("enternumber").value;
          datakeys.fname = enterfname;
          datakeys.lname = enterlname;
          datakeys.countrycode = entercountrycode;
          datakeys.mobilenumber = enternumber;
          if (enterfname == "") {
            document.getElementById("modal").style.display = "block";
            alert("Please enter your first name");
          } else if (enterlname == "") {
            document.getElementById("modal").style.display = "block";
            alert("Please enter your last name");
          } else if (entercountrycode == "") {
            document.getElementById("modal").style.display = "block";
            alert("Please enter country code");
          } else if (enternumber == "") {
            document.getElementById("modal").style.display = "block";
            alert("Please enter mobile number ");
          } else {
            alert("Your form is completed");
            let contactdetails = [];
            let contactinfo = localStorage.getItem("localtask");
            if (!contactinfo) {
              contactdetails = [];
            } else {
              contactdetails = JSON.parse(contactinfo);

              const editdetails = localStorage.getItem("editid");
              datakeys.id = parseInt(editdetails);

              const editvalue = contactdetails.findIndex(
                (data) => data.id === edittask
              );
              contactdetails[editvalue].fname = enterfname;
              contactdetails[editvalue].lname = enterlname;
              contactdetails[editvalue].countrycode = entercountrycode;
              contactdetails[editvalue].mobilenumber = enternumber;
              localStorage.setItem("localtask", JSON.stringify(contactdetails));
              document.getElementById("opendatatable").style.opacity = 1;
            }
          }
          showtask();
        };
      }
      function deleteupdatetask(deletetask) {
        const changevalue = contactdetails.findIndex(
          (data) => data.id === deletetask
        );
        contactdetails.splice(changevalue, 1);
        localStorage.setItem("localtask", JSON.stringify(contactdetails));
        editdeleteupdate(contactdetails);
      }
    </script>
  </body>
</html>
